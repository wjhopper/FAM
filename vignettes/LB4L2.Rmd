---
title: "'List Before Last: All 2 Cues' Performance Analysis"
author: "Will Hopper"
date: "`r Sys.Date()`"
output: 
  html_document:
    fig_caption: yes
    toc: true
    toc_depth: 2
    css: custom.css
vignette: >
  %\VignetteIndexEntry{LB4L2: All 2 Cues}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
<style>

img {
  padding: 10px;
  border-bottom: 2px solid #000;
}

</style>
```{r setup, include=FALSE}
devtools::load_all()
library(dplyr)
library(tidyr)
library(whoppeR)
library(ggplot2)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, fig.align='center', fig.width = 8)
```

```{r tests, include=FALSE, eval=FALSE}
IV <- summary(LB4L2_final, level = "group")
IV_sub <- summary(LB4L2_final, level = "subject")

CD <- summary(LB4L2_final, level = "group", given_practice = TRUE, conditional = TRUE) 
identical(summary(LB4L2_final, level = "group", given_practice = 1:2, conditional = TRUE), CD)
CD_1 <- summary(LB4L2_final, level = "group", given_practice = 1, conditional = TRUE)
CD_2 <- summary(LB4L2_final, level = "group", given_practice = 2, conditional = TRUE)

joint <- summary(LB4L2_final, level = "group", given_practice = TRUE)
joint_1 <- summary(LB4L2_final, level = "group", given_practice = 1)
joint_2 <- summary(LB4L2_final, level = "group", given_practice = 2)

CD_raw <- summary(LB4L2_final, level = "raw", given_practice = TRUE, conditional = TRUE)
joint_raw <- summary(LB4L2_final, level = "raw", given_practice = TRUE)
identical(CD_raw, joint_raw)
```

## Accuracy and RT by Experimental Condition
```{r IV, }
IV <- summary(LB4L2_final, level = "group")
autoplot(IV, DV = "accuracy")
autoplot(IV, DV = "RT")
```

## Conditional Accuracy and RT
```{r conditionals}
CD_1 <- summary(LB4L2_final, level = "group", given_practice = 1, conditional = TRUE)
autoplot(CD_1, DV = "accuracy")
autoplot(CD_1, DV = "RT")
```

## Joint Accuracy and RT
```{r joint}
joint_1 <- summary(LB4L2_final, level = "group", given_practice = 1)
autoplot(joint_1, DV = "accuracy")
autoplot(joint_1, DV = "RT")
```


## Quantile Plots
```{r quantiles, fig.height=8,fig.width = 11}
IV_sub <- summary(LB4L2_final, level = "subject")

quantile_points <- seq(.01,1,length.out = 100)
quantiles_correct <- IV_sub %>%
  filter(final_acc == 1,
         !is.na(RT)) %>%
  group_by(group, practice, OCpractice) %>%
  do(data.frame(probability = quantile_points,
                RT = quantile(.$RT,
                              probs=quantile_points,
                              names=FALSE)
                )
     ) %>%
  ungroup() %>%
  left_join(y = filter(IV, final_acc==1) %>%
              select(group,practice,OCpractice,mean_p)) %>%
  mutate(probability = probability * mean_p)

practice_labels <- c(N.N = "Baseline",
                     N.S = "Study, Other Cue",
                     S.N = "Study, Same Cue",
                     N.T = "Test, Other Cue",
                     T.N = "Test, Same Cue")

capitalize <- function(string) {
  substr(string, 1, 1) <- toupper(substr(string, 1, 1))
  string
}

quantile_plot <- ggplot(quantiles_correct,
                        aes(x=RT,
                            y=probability,
                            color = interaction(practice, OCpractice)
                            )
                        ) +
  geom_line(size=.75) +
  facet_grid(.~ group,
             labeller = labeller(.default = capitalize)
             ) + 
  scale_color_discrete(name="Condition",
                       breaks = c("N.N","N.S","N.T","S.N","T.N"),
                       labels = practice_labels) +
  scale_x_continuous(breaks = 0:6,
                     limits=c(0,6)) + 
  theme_grey(base_size = 16)
print(quantile_plot)
```

### Pooled Quantiles
```{r pooled_quantiles, fig.height=8,fig.width = 11}
IV_acc_pooled <- LB4L2_final %>%
  group_by(group,practice,OCpractice) %>%
  summarise(acc=mean(acc))
  
pooled_quantiles_correct <- LB4L2_final %>%
  filter(acc == 1) %>%
  group_by(group, practice, OCpractice) %>%
  do(data.frame(probability = quantile_points,
                RT = quantile(.$RT,
                              probs=quantile_points,
                              names=FALSE)
                )
     ) %>%
  ungroup() %>%
  left_join(y = IV_acc_pooled) %>%
  mutate(probability = probability * acc)

quantile_plot %+% pooled_quantiles_correct
```
